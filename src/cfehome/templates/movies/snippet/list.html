{% load get_dict_val %}
{% for object in object_list %}
<div class="col-lg-3 col-md-4 col-sm-6 soon released">
    <div class="single-portfolio">
        <div class="single-portfolio-img">
            
            <a href="{{ object.get_absolute_url }}" class="popup">
                <img src="https://image.tmdb.org/t/p/original/{{ object.poster_path }}" alt="portfolio" />
            </a>
        </div>
        <div class="portfolio-content">
            <h2>{{ object.title }} <small>({{ object.release_date.year }})</small></h2>
            <p>{{ object.id }}</p>
            <small>{{ my_ratings|get_dict_val:object.id }}</small>
            <div class="review">
                <div class="author-review" id="starRating">
                    {% if object.rating_avg >= 1 %}
                        <i class="icofont icofont-star filled"></i>
                    {% else %}
                        <i class="icofont icofont-star-o"></i>
                    {% endif %}
                    {% if object.rating_avg >= 2 %}
                        <i class="icofont icofont-star filled"></i>
                    {% elif object.rating_avg > 1 %}
                        <i class="icofont icofont-star-half"></i>
                    {% else %}
                        <i class="icofont icofont-star-o"></i>
                    {% endif %}
                    {% if object.rating_avg >= 3 %}
                        <i class="icofont icofont-star filled"></i>
                    {% elif object.rating_avg > 2 %}
                        <i class="icofont icofont-star-half"></i>
                    {% else %}
                        <i class="icofont icofont-star-o"></i>
                    {% endif %}
                    {% if object.rating_avg >= 4 %}
                        <i class="icofont icofont-star filled"></i>
                    {% elif object.rating_avg > 3 %}
                        <i class="icofont icofont-star-half"></i>
                    {% else %}
                        <i class="icofont icofont-star-o"></i>
                    {% endif %}
                    {% if object.rating_avg >= 5 %}
                        <i class="icofont icofont-star filled"></i>
                    {% elif object.rating_avg > 4 %}
                        <i class="icofont icofont-star-half"></i>
                    {% else %}
                        <i class="icofont icofont-star-o"></i>
                    {% endif %}
                </div>
                <br>
            </div>
            <br>
            {% with my_ratings|get_dict_val:object.id as current_ratings %}
                <div>
                    {% include 'ratings/snippet/rating-choices.html' with object_id=object.id current_rating=current_rating %}
                </div>
            {% endwith %}
            <br>
            <br>
            {% if object.rating_avg %}
            <h6>average rating: {{object.rating_avg }}</h6>
            <br>
            <h6>ratings: {{ object.rating_count }}</h6>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}

<script>
    // Assuming object.rating_avg holds the rating average value
    var ratingAvg = object.rating_avg; // Replace object.rating_avg with the actual value

    // Round the rating average to the nearest half star
    var roundedRating = Math.round(ratingAvg * 2) / 2;

    // Generate star icons based on the rounded rating average
    var starHtml = '';
    for (var i = 1; i <= 5; i++) {
        if (i <= roundedRating) {
            // Full star
            starHtml += '<i class="icofont icofont-star"></i>';
        } else if (i - 0.5 === roundedRating) {
            // Half star
            starHtml += '<i class="icofont icofont-star-half"></i>';
        } else {
            // Empty star
            starHtml += '<i class="icofont icofont-star-o"></i>';
        }
    }

    // Insert the generated star icons into the div
    document.getElementById('starRating').innerHTML = starHtml;
</script>